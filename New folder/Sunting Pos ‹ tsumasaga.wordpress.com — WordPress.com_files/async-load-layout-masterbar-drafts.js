webpackJsonp([8252115265040787,0xf5d7f47f5cb74],{95148365001489:function(t,e,s){"use strict";function a(t){return t&&t.__esModule?t:{default:t}}function r(t){var e=(new Date).getTime(),s=t.timeSaved;return e-s>k}function n(t){return u(t)?x[t].list:void(x[t]&&x[t].dirty&&(O("delete cached list %o",t),delete x[t],delete w[t]))}function i(t){var e=l(t.query);x[e]&&x[e].dirty||(x[e]={timeStored:(new Date).getTime(),dirty:!1,list:t,listKey:e})}function o(t,e){var s=N.getSite(t.site_ID),a=[s.slug,s.ID,!1],r=[t.status,e],n=void 0,i=void 0,o=void 0,u=void 0;for(i in x)x.hasOwnProperty(i)&&(o=x[i],u=o.list,u.query.type===t.type&&-1!==a.indexOf(u.query.siteID)&&(n=u.query.status.split(","),0!==(0,y.default)(n,r).length&&(o.dirty=!0)));D.cacheIndex.clearRecordsByParamFilter(function(t){var e=a.slice(0,-1),s=["/me/posts"].concat((0,_.default)(e.map(function(t){return"/sites/"+t+"/posts"}))),n=t.query&&t.query.status?t.query.status.split(","):[],i=(0,y.default)(n,r);return s.indexOf(t.path)!==-1&&!!i.length})}function u(t){return x[t]&&!r(x[t])&&!x[t].dirty}function l(t){var e=[],s=(0,g.default)(t).sort();return s.forEach(function(s){e.push(s+"-"+t[s])}),e.join(":")}function c(t,e,s){O("setCanonicalList %o %o (%o)",t,e,s),w[t]=w[t]||{},w[t][e]=s}function d(t,e){O("getCanonicalList %o %o",t,e);var s=w[t];if(!s||"object"!==("undefined"==typeof s?"undefined":(0,h.default)(s)))return!1;var a=(0,g.default)(s);return a[0]!==e?(delete x[t],delete w[t],!1):s[e]}function p(t,e){O("deleteCanonicalList %o %o",t,e);var s=w[t];s&&s[e]&&delete s[e]}Object.defineProperty(e,"__esModule",{value:!0});var f=s(95905449861643),h=a(f),m=s(477028190620861),g=a(m),v=s(6465156853722425),_=a(v);e.getCacheKey=l,e.setCanonicalList=c,e.getCanonicalList=d,e.deleteCanonicalList=p;var E=s(7905250771901207),y=a(E),P=s(4675954658966525),S=a(P),T=s(7418474439241154),b=a(T),I=s(8769427305820155),C=a(I),D=s(0x59542bda68774),x={},w={},k=3e5,N=(0,b.default)(),A={get:n,_reset:function(){x={}}},O=(0,S.default)("calypso:posts-list:cache");A.dispatchToken=C.default.register(function(t){var e=t.action,a=s(0x69c14441898c8)();switch(C.default.waitFor([a.dispatchToken]),e.type){case"FETCH_NEXT_POSTS_PAGE":i(a.get());break;case"RECEIVE_POSTS_PAGE":i(a.get());break;case"RECEIVE_UPDATED_POSTS":i(a.get());break;case"RECEIVE_UPDATED_POST":case"RECEIVE_POST_BEING_EDITED":e.post&&(o(e.post,e.original?e.original.status:null),i(a.get()))}}),e.default=A},379676959299837:function(t,e,s){"use strict";function a(t,e){return n(e,function(e){return d(e.items,{id:t.id})})||e}function r(t,e,s){return e.forEach(function(e){t=e(t,s)},this),t.items&&(t.items=t.items.map(function(t){return r(t,e,s)})),t}function n(t,e){return e(t)?t:t.items?o(t.items,function(t){return n(t,e)}):void 0}function i(t,e,s){var a;if(t.items)for(a=0;a<t.items.length;a++){if(s(t.items[a]))return void(t.items[a]=e);i(t.items[a],e,s)}}function o(t,e){var s,a,r=t.length;for(s=0;s<r;s++)if(a=e(t[s]))return a}function u(t,e){return function(s){return s.id===e&&(s.items=s.items||[],s.items.push(t)),s}}function l(t,e,s){return function(a){var r,n="before"===s?0:1;return~(r=c(a.items,{id:e}))&&a.items.splice(r+n,0,t),a}}var c=s(619801137403500),d=s(6442230718320275);t.exports={traverse:function(t,e){return r(t,e,t)},parent:a,find:n,replaceItem:i,remover:function(t){return function(e){var s;return~(s=c(e.items,{id:t}))&&e.items.splice(s,1),e}},inserter:function(t,e,s){var a="child"===s?u:l;return a(t,e,s)}}},499413011598538:function(t,e,s){"use strict";function a(t){return t&&t.__esModule?t:{default:t}}function r(t,e,s){return{type:u.POST_COUNTS_RECEIVE,siteId:t,postType:e,counts:s}}function n(t,e){return function(s){return s({type:u.POST_COUNTS_REQUEST,postType:e,siteId:t}),o.default.undocumented().site(t).postCounts({type:e}).then(function(a){s(r(t,e,a.counts)),s({type:u.POST_COUNTS_REQUEST_SUCCESS,siteId:t,postType:e})}).catch(function(a){s({type:u.POST_COUNTS_REQUEST_FAILURE,siteId:t,postType:e,error:a})})}}Object.defineProperty(e,"__esModule",{value:!0}),e.receivePostCounts=r,e.requestPostCounts=n;var i=s(8478035041892969),o=a(i),u=s(0xd047e5c4c63f8)},0x4e09390d58627:function(t,e,s){"use strict";function a(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var r=s(0xccd53b671ebb6),n=a(r),i=s(5143893728007863),o=a(i),u=s(5880884711457125),l=a(u),c=s(8173823076638946),d=a(c),p=s(5369032381290393),f=a(p),h=s(5896763357248615),m=s(6280957995252369),g=s(499413011598538),v=s(0xb952c2ac6b114),_=function(t){function e(){return(0,o.default)(this,e),(0,d.default)(this,(e.__proto__||(0,n.default)(e)).apply(this,arguments))}return(0,f.default)(e,t),(0,l.default)(e,[{key:"componentWillMount",value:function(){this.request(this.props)}},{key:"componentWillReceiveProps",value:function(t){this.props.siteId===t.siteId&&this.props.type===t.type||this.request(t)}},{key:"request",value:function(t){t.requesting||t.requestPostCounts(t.siteId,t.type)}},{key:"render",value:function(){return null}}]),e}(h.Component);_.propTypes={siteId:h.PropTypes.number.isRequired,type:h.PropTypes.string.isRequired,requesting:h.PropTypes.bool,requestPostCounts:h.PropTypes.func},e.default=(0,m.connect)(function(t,e){var s=e.siteId,a=e.type;return{requesting:(0,v.isRequestingPostCounts)(t,s,a)}},{requestPostCounts:g.requestPostCounts})(_),t.exports=e.default},0x69c14441898c8:function(t,e,s){"use strict";function a(t){return t&&t.__esModule?t:{default:t}}function r(t){var e=t||"default";return o[e]||(o[e]=new i.default(e)),o[e]}Object.defineProperty(e,"__esModule",{value:!0}),e.default=r;var n=s(4730164382473449),i=a(n),o={};r._reset=function(){o={}},t.exports=e.default},0x7df7df5329b0e:function(t,e,s){"use strict";var a=s(5896763357248615),r=s(6104353596224629),n=s(623310115397031);t.exports={getInitialState:function(){return{updated:!1,updatedStatus:null,previousStatus:null}},buildUpdateTemplate:function(){var t,e,s,r,n=this.props.post||this.props.page,i=this.state.updatedStatus,o="conf-alert",u=this.strings;if(this.state.updated){switch(i){case"trashing":case"deleting":r="deleting"===i?u.deleting:u.trashing,t=a.createElement("span",null,r," ",a.createElement("span",{className:"loading-dot"},"."),a.createElement("span",{className:"loading-dot"},"."),a.createElement("span",{className:"loading-dot"},".")),o+=" conf-alert--trashing";break;case"trash":s=this.resetToPreviousState,e=a.createElement("a",{className:"undo",onClick:s},a.createElement("span",null,u.undo)),t=u.trashed,o+=" conf-alert--trashed";break;case"deleted":t=u.deleted,o+=" conf-alert--deleted";break;case"updating":t=a.createElement("span",null,u.updating," ",a.createElement("span",{className:"loading-dot"},"."),a.createElement("span",{className:"loading-dot"},"."),a.createElement("span",{className:"loading-dot"},".")),o+=" conf-alert--updating";break;case"error":t=u.error,o+=" conf-alert--error";break;case"restoring":t=a.createElement("span",null,u.restoring," ",a.createElement("span",{className:"loading-dot"},"."),a.createElement("span",{className:"loading-dot"},"."),a.createElement("span",{className:"loading-dot"},".")),o+=" conf-alert--updating";break;default:t="trash"===this.state.previousStatus?u.restored:u.updated}return a.createElement("div",{key:n.global_ID+"-update",className:"updated-confirmation"},a.createElement("div",{className:o},a.createElement("div",{className:"conf-alert_con"},a.createElement("span",{className:"conf-alert_title"},t),e)))}},updatePostStatus:function(t){var e,s=this.props.post||this.props.page,a=null,n=this.strings;e=function(t,e){return t?(this.setErrorState(),!1):(this.setState({previousStatus:a,updatedStatus:e.status,showMoreOptions:!1}),!0)}.bind(this),"delete"===t?(this.setState({updatedStatus:"deleting",updated:!0}),window.confirm(n.deleteWarning)?r.trash(s,e):this.resetState()):"trash"===t?(this.setState({updatedStatus:"trashing",updated:!0}),a=s.status,r.trash(s,e)):"restore"===t?(this.setState({updatedStatus:"restoring",updated:!0}),a="trash",r.restore(s,e)):(this.setState({updatedStatus:"updating",updated:!0}),r.update(s,{status:t},function(t,s){e(t,s)&&setTimeout(function(){this.resetState()}.bind(this),1200)}.bind(this)))},setErrorState:function(){this.setState({updated:!0,updatedStatus:"error"}),setTimeout(function(){this.resetState()}.bind(this),1200)},resetState:function(){this.setState({updatedStatus:null,updated:!1,showMoreOptions:!1,showPageActions:!1})},resetToPreviousState:function(){var t=this.props.page?{group:"Pages",eventName:"Clicked Undo Trashed Page"}:{group:"Posts",eventName:"Clicked Undo Trashed Post"};n.ga.recordEvent(t.group,t.eventName),this.state.previousStatus&&this.updatePostStatus(this.state.previousStatus)}}},0xb952c2ac6b114:function(t,e,s){"use strict";function a(t){return t&&t.__esModule?t:{default:t}}function r(t,e,s){return(0,g.default)(t.posts.counts.requesting,[e,s],!1)}function n(t,e,s){return(0,g.default)(t.posts.counts.counts,[e,s,"all"],null)}function i(t,e,s,a){var r=n(t,e,s);return r?r[a]||0:null}function o(t,e,s){return(0,g.default)(t.posts.counts.counts,[e,s,"mine"],null)}function u(t,e,s,a){var r=o(t,e,s);return r?r[a]||0:null}function l(t,e,s){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:n,r=a(t,e,s);return v.reduce(function(t,e){var s=(0,g.default)(r,e,0),a=void 0;switch(e){case"publish":case"private":a="publish";break;case"draft":case"pending":a="draft";break;default:a=e}return(0,h.default)({},t,(0,p.default)({},a,(t[a]||0)+s))},{})}function c(t,e,s){return l(t,e,s,o)}Object.defineProperty(e,"__esModule",{value:!0});var d=s(0xc729f06ce7488),p=a(d),f=s(5630966280090368),h=a(f);e.isRequestingPostCounts=r,e.getAllPostCounts=n,e.getAllPostCount=i,e.getMyPostCounts=o,e.getMyPostCount=u,e.getNormalizedPostCounts=l,e.getNormalizedMyPostCounts=c;var m=s(8640881565075096),g=a(m),v=["publish","draft","pending","private","future","trash"]},0xe5816b799bd0f:function(t,e,s){"use strict";function a(t){var e=i.get(t.global_ID);e&&o(t,e)||(d[t.global_ID]=t)}function r(t,e){var s=e||{},r=s.global_ID;if(!r)return void u("global_ID is required for a post",e);var n=i.get(r);return n&&"local"===t?void u("existing record (%o), do not overwrite with local response",n):void l.normalizeSync(e,function(t,e){a(e)})}function n(t,e){var s=r.bind(null,e);t.forEach(s)}var i,o=s(0xf0f4288728240),u=s(4675954658966525)("calypso:posts"),l=s(0x5dd72de17825d),c=s(8769427305820155),d={};i={get:function(t){return d[t]}},i.dispatchToken=c.register(function(t){var e=t.action;switch(e.type){case"RECEIVE_POSTS_PAGE":case"RECEIVE_UPDATED_POSTS":if(!e.error&&e.data.posts){var s=e.data.__sync&&e.data.__sync.responseSource;n(e.data.posts,s)}break;case"RECEIVE_UPDATED_POST":e.error||r("server",e.post)}}),t.exports=i},4730164382473449:function(t,e,s){"use strict";function a(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(t.length<3||e.length<2)return[];var s=t.indexOf(e[0]);if(s===-1)return r(t,e.slice(1));var a=t.indexOf(e.slice(-1)[0]);if(a===-1)return r(t,e.slice(0,-1));var n=t.slice(s,a+1);return(0,C.default)(n,e)}Object.defineProperty(e,"__esModule",{value:!0});var n=s(0xccd53b671ebb6),i=a(n),o=s(5143893728007863),u=a(o),l=s(5880884711457125),c=a(l),d=s(8173823076638946),p=a(d),f=s(5369032381290393),h=a(f),m=s(95905449861643),g=a(m);e.getRemovedPosts=r,e.default=function(t){function e(t){var e=(0,S.default)({},B,t);e.siteID&&"string"==typeof e.siteID&&(e.siteID=e.siteID.replace(/::/g,"/")),"draft,pending"===e.status&&(e.orderBy="modified");var s=(0,F.getCacheKey)(e),a=j.default.get(s);a?l=a:(l={id:G,postIds:[],errors:[],page:0,isLastPage:!1,isFetchingNextPage:!1,isFetchingUpdated:!1,query:e,listKey:s},G++)}function s(t){return(0,b.default)(t,function(t,e,s){null!=e&&(t[s]=e)},{})}function a(){var t=l.query.orderBy;l.postIds.sort(function(e,s){var a=q.default.get(e),r=q.default.get(s),n=a[t],i=r[t];return n===i?a.title===r.title?0:a.title>r.title?1:-1:n>i?-1:1})}function n(t,e,s){if(e||!s||"object"!==("undefined"==typeof s?"undefined":(0,g.default)(s)))return e=e||{message:"Error fetching PostsList: empty data response"},H("Error fetching PostsList from api:",e),e.timestamp=Date.now(),void l.errors.push(e);var n=s.found,i=s.meta,o=s.posts,u=s.__sync,c=u||{},d=c.responseSource,p=c.requestKey;if(t===l.id){l.isFetchingNextPage=!1,l.nextPageHandle=i&&i.next_page,l.nextPageHandle&&n||(l.isLastPage=!0);var f=o.map(function(t){return t.global_ID}),h=l.postIds.slice(0);if("local"===d&&p)(0,F.setCanonicalList)(l.listKey,p,h);else{var m=(0,F.getCanonicalList)(l.listKey,p);m&&(H("canonicalList found (%o)",m),h=m,(0,F.deleteCanonicalList)(l.listKey,p))}var v=r(h,f);v.length&&(H("removePosts (%o)",v),h=(0,C.default)(h,v));var _=(0,C.default)(f,h);_.length&&(H("newPosts (%o)",_),h=h.concat(_),l.page++),l.postIds=h,a()}}function o(t,e,s){var r=void 0,n=void 0,i=void 0;return e?void H("An error occurred while fetching updated posts %o",e):void(t===l.id&&s.posts.length&&(r=s.posts,H("Fetched updated posts:",r),n=r.map(function(t){return t.global_ID}),i=(0,C.default)(n,l.postIds),i.length&&(l.postIds=l.postIds.concat(i),a())))}if(!t)throw new Error("must supply a post-list-store id");var l={postIds:[],errors:[],query:(0,y.default)(B),page:0,nextPageHandle:!1,isLastPage:!1,isFetchingNextPage:!1,isFetchingUpdated:!1};return new(function(a){function r(){(0,u.default)(this,r);var e=(0,p.default)(this,(r.__proto__||(0,i.default)(r)).call(this));return e.id=t,e.dispatchToken=M.default.register(e.handlePayload.bind(e)),e}return(0,h.default)(r,a),(0,c.default)(r,[{key:"get",value:function(){return l}},{key:"getID",value:function(){return l.id}},{key:"getSiteID",value:function(){return l.query.siteID}},{key:"getAll",value:function(){return l.postIds.map(function(t){return q.default.get(t)})}},{key:"getTree",value:function(){var t=[];return l.postIds.forEach(function(e){var s=(0,y.default)(q.default.get(e));s.parent=s.parent?s.parent.ID:0,t.push(s)}),(0,V.default)("ID").treeify(t)}},{key:"getPost",value:function(t){if(l.postIds.indexOf(t)>-1)return q.default.get(t)}},{key:"getPage",value:function(){return l.page}},{key:"off",value:function(t,e){this.removeListener(t,e)}},{key:"isLastPage",value:function(){return l.isLastPage}},{key:"isFetchingNextPage",value:function(){return l.isFetchingNextPage}},{key:"hasRecentError",value:function(){var t=30,e=Date.now();return(0,O.default)(l.errors,function(s){return e-s.timestamp<1e3*t})}},{key:"getNextPageParams",value:function(){var t={},e=l.query;return t.status=e.status,t.order_by=e.orderBy,t.order=e.order,t.author=e.author,t.number=e.perPage,t.type=e.type,t.page_handle=l.nextPageHandle,t.exclude_tree=e.exclude_tree,t.number=e.number,t.before=e.before,t.after=e.after,e.search&&(t.search=e.search),t.siteID||(t.site_visibility="visible"),e.meta&&(t.meta=e.meta),s(t)}},{key:"getUpdatesParams",value:function(){var t={},e=l.query;return t.status=e.status,t.author=e.author,t.type=e.type,e.search&&(t.search=e.search),t.siteID||(t.site_visibility="visible"),e.meta&&(t.meta=e.meta),l.postIds.length&&(t.modified_after=(0,k.default)(this.getAll(),function(t){return new Date(t.modified).getTime()}).modified,"modified"===e.orderBy||l.isLastPage||(t.after=this.getPost((0,x.default)(l.postIds)).date)),s(t)}},{key:"handlePayload",value:function(t){var s=t.action;if(!s.postListStoreId||s.postListStoreId===this.id||"RECEIVE_UPDATED_POST"===s.type)switch(M.default.waitFor([q.default.dispatchToken]),s.type){case"QUERY_POSTS":H("QUERY_POSTS",s),e(s.options),this.emit("change");break;case"FETCH_NEXT_POSTS_PAGE":H("FETCH_NEXT_POSTS_PAGE",s),l.isFetchingNextPage=!0,this.emit("change");break;case"RECEIVE_POSTS_PAGE":H("receivePage",s),n(s.id,s.error,s.data),this.emit("change");break;case"RECEIVE_UPDATED_POSTS":o(s.id,s.error,s.data),this.emit("change");break;case"RECEIVE_UPDATED_POST":s.post&&l.postIds.indexOf(s.post.global_ID)>-1&&this.emit("change")}}}]),r}(N.EventEmitter))};var v=s(4675954658966525),_=a(v),E=s(8446265970839099),y=a(E),P=s(8907951692841672),S=a(P),T=s(9002016994434229),b=a(T),I=s(411492589843630),C=a(I),D=s(4881459746320230),x=a(D),w=s(7880968143996541),k=a(w),N=s(842421528365869),A=s(6442230718320275),O=a(A),R=s(8769427305820155),M=a(R),U=s(5408478231187706),V=a(U),L=s(0xe5816b799bd0f),q=a(L),F=s(95148365001489),j=a(F),B={siteID:!1,type:"post",status:"publish",orderBy:"date",order:"DESC",author:!1,search:!1,perPage:20},H=(0,_.default)("calypso:posts-list"),G=0},4952817180264681:function(t,e,s){"use strict";function a(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var r=s(0xccd53b671ebb6),n=a(r),i=s(5143893728007863),o=a(i),u=s(5880884711457125),l=a(u),c=s(8173823076638946),d=a(c),p=s(5369032381290393),f=a(p),h=s(5896763357248615),m=a(h),g=s(6280957995252369),v=s(7572476330282672),_=s(0xe6bd8709d6a3c),E=s(8326181498771179),y=a(E),P=s(0x4c328c9015af2),S=a(P),T=s(0xb952c2ac6b114),b=s(6007716273106560),I=s(7796403284935571),C=a(I),D=s(0xb0498bd0dc158),x=a(D),w=s(0x4e09390d58627),k=a(w),N=s(7186610166862683),A=a(N),O=s(5621169132512541),R=a(O),M=s(0x956a8e02ae2a5),U=s(7418474439241154),V=a(U),L=(0,V.default)(),q=function(t){function e(){var t,s,a,r;(0,o.default)(this,e);for(var i=arguments.length,u=Array(i),l=0;l<i;l++)u[l]=arguments[l];return s=a=(0,d.default)(this,(t=e.__proto__||(0,n.default)(e)).call.apply(t,[this].concat(u))),a.state={showDrafts:!1},a.toggleDrafts=function(){var t=a.state.showDrafts;a.setState({showDrafts:!t})},a.closeDrafts=function(){a.setState({showDrafts:!1})},r=s,(0,d.default)(a,r)}return(0,f.default)(e,t),(0,l.default)(e,[{key:"render",value:function(){var t=this.props,e=t.selectedSite,s=t.draftCount,a=t.loadingDrafts,r=t.translate,n=0!==s&&a;return e?m.default.createElement("div",null,m.default.createElement(k.default,{siteId:e.ID,type:"post"}),this.props.draftCount>0&&m.default.createElement(A.default,{compact:!0,borderless:!0,className:"masterbar__toggle-drafts",onClick:this.toggleDrafts,ref:"drafts",title:r("Latest Drafts")},m.default.createElement(S.default,{count:this.props.draftCount})),m.default.createElement(y.default,{isVisible:this.state.showDrafts,onClose:this.closeDrafts,position:"bottom left",context:this.refs&&this.refs.drafts,className:"masterbar__recent-drafts"},m.default.createElement(x.default,{siteId:e.ID,query:this.props.draftsQuery}),m.default.createElement(R.default,{compact:!0,site:e}),this.props.drafts&&this.props.drafts.map(this.renderDraft,this),n&&m.default.createElement(C.default,{isPlaceholder:!0}),this.props.draftCount>6&&m.default.createElement(A.default,{compact:!0,borderless:!0,className:"masterbar__see-all-drafts",href:"/posts/drafts/"+e.slug,onClick:this.closeDrafts},r("See all drafts"),this.props.draftCount?m.default.createElement(S.default,{count:this.props.draftCount}):null))):null}},{key:"renderDraft",value:function(t){if(!t)return null;var e=this.props.selectedSite;return m.default.createElement(C.default,{key:t.global_ID,post:t,sites:L,showAuthor:e&&!e.single_user_site&&!this.props.userId,onTitleClick:this.closeDrafts})}}]),e}(h.Component);q.propTypes={user:h.PropTypes.object,sites:h.PropTypes.object,isActive:h.PropTypes.bool,className:h.PropTypes.string,tooltip:h.PropTypes.string,selectedSite:h.PropTypes.object},e.default=(0,g.connect)(function(t){var e=(0,_.getSelectedSiteId)(t),s=(0,M.getCurrentUserId)(t),a=(0,_.getSelectedSite)(t),r={type:"post",status:"draft",number:10,order_by:"modified",author:!a||a.jetpack||a.single_user_site?null:s},n=(0,T.getMyPostCounts)(t,e,"post");return{drafts:(0,b.getSitePostsForQueryIgnoringPage)(t,e,r),loadingDrafts:(0,b.isRequestingSitePostsForQuery)(t,e,r),draftsQuery:r,draftCount:n&&n.draft,selectedSite:a}})((0,v.localize)(q)),t.exports=e.default},5084380759969092:function(t,e,s){"use strict";function a(t){return t&&t.__esModule?t:{default:t}}function r(t,e){var s=void 0,a=I.getSelectedSite();v.default.mc.bumpStat("editor_usage",t),a&&(s=a.jetpack?"jetpack":"wpcom",v.default.mc.bumpStat("editor_usage_"+s,t),e&&v.default.mc.bumpStat("editor_cpt_usage_"+s,e+"_"+t))}function n(t){v.default.mc.bumpStat("editor_actions",t)}function i(t,e,s){v.default.ga.recordEvent("Editor",t,e,s)}function o(){var t=E.default.get(),e=E.default.getSavedPost();if(t&&e){var s=e.status,a=t.status,o="calypso_editor_"+t.type+"_",u=!1,l=!1,c=!1;t.ID||P.default.isPublished(t)?"draft"===a?o+="savedraft":s===a?(c="edit",o+="update"):"publish"===a||"private"===a?(o+="publish",c="new"):"pending"===a?o+="pending":"future"===a&&(o+="schedule",u="status-schedule",l="Scheduled Post"):o+="savedraft",c&&r(c,t.type),u&&n(u),l&&i(l),b("recordSaveEvent %s currentStatus=%s nextStatus=%s",o,s,a),v.default.tracks.recordEvent(o,{post_id:t.ID,post_type:t.type,visibility:P.default.getVisibility(t),current_status:s,next_status:a})}}function u(t){D("editor-button","calypso_"+t),v.default.ga.recordEvent("Editor","Clicked TinyMCE Button",t),b("TinyMCE button click",t,"mc=",C)}function l(t){D("html-editor-button","calypso_"+t),v.default.ga.recordEvent("Editor","Clicked TinyMCE HTML Button",t),b("TinyMCE HTML button click",t,"mc=",C)}Object.defineProperty(e,"__esModule",{value:!0}),e.recordStat=n,e.recordEvent=i,e.recordSaveEvent=o,e.recordTinyMCEButtonClick=u,e.recordTinyMCEHTMLButtonClick=l;var c=s(4675954658966525),d=a(c),p=s(0x45d24eaab7654),f=a(p),h=s(4883949902648912),m=a(h),g=s(623310115397031),v=a(g),_=s(5367243434992214),E=a(_),y=s(0x5dd72de17825d),P=a(y),S=s(7418474439241154),T=a(S),b=(0,d.default)("calypso:posts:stats"),I=new T.default,C=Math.random()<=.01||"development"===(0,m.default)("env"),D=C?v.default.mc.bumpStat:f.default},5408478231187706:function(t,e,s){"use strict";function a(t){return this instanceof a?void(this.key=t||"id"):new a(t)}var r=s(379676959299837);a.prototype.treeify=function(t){var e=[],s={};return t.forEach(function(e,a){s[t[a][this.key]]=e},this),t.forEach(function(t){var a;t.parent>0&&s[t.parent]?(a=s[t.parent],a.items=a.items||[],a.items.push(t)):(t.parent=0,e.push(t))}),this.sortItems(e),this.removeOrderProperty(e),e},a.prototype.untreeify=function(t,e){return e=e||[],t.forEach(function(t,s){t.items&&a.prototype.untreeify(t.items,e),t.order=s+1,e.push(t)}),e},a.prototype.sortItems=function(t){var e={};e.items=t,r.traverse(e,[function(t){return t.items&&t.items.sort(function(t,e){return t.order-e.order}),t}])},a.prototype.removeOrderProperty=function(t){var e={};e.items=t,r.traverse(e,[function(t){return t.items&&t.items.forEach(function(t){delete t.order}),t}])},t.exports=a},5628363501489590:function(t,e,s){"use strict";function a(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var r=s(8907951692841672),n=a(r),i=s(5896763357248615),o=a(i),u=s(0x8ae3881d6e8c2),l=a(u),c=s(6881822108913591),d=a(c);e.default=o.default.createClass({displayName:"CompactCard",render:function(){var t=(0,n.default)({},this.props,{className:(0,l.default)(this.props.className,"is-compact")});return o.default.createElement(d.default,t,this.props.children)}}),t.exports=e.default},6104353596224629:function(t,e,s){"use strict";function a(t){return t&&t.__esModule?t:{default:t}}function r(t,e,s){var a,r=S.get();("string"==typeof t||Array.isArray(t))&&(t=(0,c.default)([].concat(t).map(function(t){return[t,e]}))),a=(r.metadata||[]).filter(function(e){return!t.hasOwnProperty(e.key)}),(0,u.default)(t).forEach(function(e){var r={key:e,operation:s};"delete"!==s&&(r.value=t[e]),a.push(r)}),x.handleViewAction({type:"EDIT_POST",post:{metadata:a}})}function n(t){return t=(0,h.default)(t),t=(0,v.normalizeTermsForApi)(t),t.author&&(t.author=t.author.ID),t}var i,o=s(477028190620861),u=a(o),l=s(5973119050011126),c=a(l),d=s(6269536571656272),p=a(d),f=s(8446265970839099),h=a(f),m=s(8907951692841672),g=a(m),v=s(6703009972949751),_=s(4675954658966525)("calypso:posts"),E=s(0xd1ca77937cbcf),y=s(8478035041892969),P=s(0xe5816b799bd0f),S=s(5367243434992214),T=s(0x69c14441898c8),b=s(0x7325fdfe77d0d),I=s(7418474439241154)(),C=s(0x5dd72de17825d),D=s(0xbc30bb6c305c5),x=s(8769427305820155),w=s(5084380759969092);i={startEditingNew:function(t,e){var s;e=e||{},s={type:"DRAFT_NEW_POST",siteId:t,postType:e.type||"post",title:e.title,content:e.content},x.handleViewAction(s)},startEditingExisting:function(t,e){var s,a=S.get();t&&(a&&a.site_ID===t&&a.ID===e||(x.handleViewAction({type:"START_EDITING_POST",siteId:t,postId:e}),s=y.site(t).post(e),s.get({context:"edit",meta:"autosave"},function(t,e){x.handleServerAction({type:"RECEIVE_POST_TO_EDIT",error:t,post:e})})))},stopEditing:function(){x.handleViewAction({type:"STOP_EDITING_POST"})},autosave:function(t){var e,s=S.get(),a=S.getSavedPost(),r=y.undocumented().site(s.site_ID);if(t=t||function(){},!S.isDirty())return t(new Error("NOT_DIRTY"));if(E.set("wpcom-autosave:"+s.site_ID+":"+s.ID,s),C.isPublished(a)||C.isPublished(s)){if(e=I.getSite(s.site_ID),!s.ID||!e||e.jetpack&&D(e.options.jetpack_version,"3.7.0-dev","<"))return t(new Error("NO_AUTOSAVE"));x.handleViewAction({type:"POST_AUTOSAVE",post:s}),r.postAutosave(s.ID,{content:s.content,title:s.title,excerpt:s.excerpt},function(e,s){x.handleServerAction({type:"RECEIVE_POST_AUTOSAVE",error:e,autosave:s}),t(e,s)})}else i.saveEdited(null,t,{recordSaveEvent:!1})},blockSave:function(t){x.handleViewAction({type:"BLOCK_EDIT_POST_SAVE",key:t})},unblockSave:function(t){x.handleViewAction({type:"UNBLOCK_EDIT_POST_SAVE",key:t})},edit:function(t){x.handleViewAction({type:"EDIT_POST",post:t})},editRawContent:function(t){x.handleViewAction({type:"EDIT_POST_RAW_CONTENT",content:t})},resetRawContent:function(){x.handleViewAction({type:"RESET_POST_RAW_CONTENT"})},updateMetadata:function(t,e){r(t,e,"update")},deleteMetadata:function(t){r(t,null,"delete")},saveEdited:function(t,e,s){var a,r,i,o,l,c,d;return x.handleViewAction({type:"EDIT_POST",post:t}),a=S.get(),S.hasContent()?S.isSaveBlocked()?void(0,p.default)(e,new Error("SAVE_BLOCKED"),a):(o=S.getChangedAttributes(),(0,u.default)(o).length?(o=n(o),l=S.getRawContent(),c=b.get("editor-mode"),d=!a.ID,x.handleViewAction({type:"EDIT_POST_SAVE"}),r=y.site(a.site_ID).post(a.ID),i={context:"edit",apiVersion:"1.2"},s&&s.recordSaveEvent===!1||w.recordSaveEvent(),(o&&"future"===o.status&&C.isFutureDated(a)||o&&"publish"===o.status&&C.isBackDated(a))&&(o=(0,g.default)({},o,{status:"publish",date:a.date})),void r[d?"add":"update"](i,o,function(t,s){var a,r;r=b.get("editor-mode"),t||(a=P.get(s.global_ID)),x.handleServerAction({type:"RECEIVE_POST_BEING_EDITED",error:t,rawContent:c===r?l:null,isNew:d,original:a,post:s}),e(t,s)})):void(0,p.default)(e,new Error("NO_CHANGE"),a)):void(0,p.default)(e,new Error("NO_CONTENT"),a)},update:function(t,e,s){var a=y.site(t.site_ID).post(t.ID);a.update(e,i.receiveUpdate.bind(null,s))},trash:function(t,e){var s=y.site(t.site_ID).post(t.ID);s.delete(i.receiveUpdate.bind(null,e))},restore:function(t,e){var s=y.site(t.site_ID).post(t.ID);s.restore(i.receiveUpdate.bind(null,e))},queryPosts:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"default";x.handleViewAction({type:"QUERY_POSTS",options:t,postListStoreId:e})},fetchNextPage:function(){var t,e,s,a,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default";a=T(r),a.isLastPage()||a.isFetchingNextPage()||(x.handleViewAction({type:"FETCH_NEXT_POSTS_PAGE",postListStoreId:r}),e=a.getID(),t=a.getNextPageParams(),s=a.getSiteID(),s?y.site(s).postsList(t,i.receivePage.bind(null,e,r)):y.me().postsList(t,i.receivePage.bind(null,e,r)))},receivePage:function(t,e,s,a){x.handleServerAction({type:"RECEIVE_POSTS_PAGE",id:t,postListStoreId:e,error:s,data:a})},fetchUpdated:function(){var t,e,s,a,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default";a=T(r),a.isFetchingNextPage()||(x.handleViewAction({type:"FETCH_UPDATED_POSTS",postListStoreId:r}),t=a.getID(),e=a.getUpdatesParams(),s=a.getSiteID(),s?(_("Fetching posts that have been updated for %s since %s %o",s,e.modified_after,e),y.site(s).postsList(e,i.receiveUpdated.bind(null,t,r))):(_("Fetching posts that have been updated since %s %o",e.modified_after,e),y.me().postsList(e,i.receiveUpdated.bind(null,t,r))))},receiveUpdated:function(t,e,s,a){x.handleServerAction({type:"RECEIVE_UPDATED_POSTS",id:t,postListStoreId:e,error:s,data:a})},receiveUpdate:function(t,e,s){var a;e||(a=P.get(s.global_ID)),x.handleServerAction({type:"RECEIVE_UPDATED_POST",error:e,original:a,post:s}),t(e,s)},fetchCounts:function(t,e){x.handleViewAction({type:"FETCH_POST_COUNTS",siteId:t}),y.undocumented().site(t).postCounts(e,function(e,s){x.handleServerAction({type:"RECEIVE_POST_COUNTS",error:e,data:s,siteId:t})})}},t.exports=i},7676928569480141:function(t,e,s){"use strict";var a=s(5896763357248615),r=s(19189154744278),n=s(0xa505046780b0c);t.exports=a.createClass({displayName:"PostRelativeTime",mixins:[r],propTypes:{post:a.PropTypes.object.isRequired,includeNonDraftStatuses:a.PropTypes.bool,link:a.PropTypes.string,target:a.PropTypes.string},getDefaultProps:function(){return{includeNonDraftStatuses:!1,link:null,target:null}},getRelativeTimeText:function(){var t=this.props.post.status,e=void 0;if("draft"===t||"pending"===t?e=this.props.post.modified:"new"!==t&&(e=this.props.post.date),e)return a.createElement("span",{className:"post-relative-time-status__time"},a.createElement(n,{icon:"time",size:18}),a.createElement("span",{className:"post-relative-time-status__time-text"},this.moment(e).fromNow()))},getStatusText:function(){var t,e=this.props.post.status,s="post-relative-time-status__status",r="aside";if(this.props.post.sticky?(t=this.translate("sticky"),s+=" is-sticky",r="bookmark-outline"):"pending"===e?(t=this.translate("pending review"),s+=" is-pending"):"future"===e?(t=this.translate("scheduled"),s+=" is-scheduled",r="calendar"):"trash"===e?(t=this.translate("trashed"),s+=" is-trash",r="trash"):this.props.includeBasicStatus&&("draft"===e?t=this.translate("draft"):"publish"===e?t=this.translate("published"):"new"===e&&(t=this.translate("Publish immediately"))),t)return a.createElement("span",{className:s},a.createElement(n,{icon:r,size:18}),a.createElement("span",{className:"post-relative-time-status__status-text"},t))},render:function(){var t,e=this.getRelativeTimeText(),s=this.getStatusText(),r=e?"post-relative-time-status":null,n=a.createElement("span",null,e,s);if(this.props.link){var i="_blank"===this.props.target?"noopener noreferrer":null;t=a.createElement("p",{className:r},a.createElement("a",{href:this.props.link,target:this.props.target,rel:i,onClick:this.props.onClick},n))}else t=a.createElement("p",{className:r},n);return t}})},7796403284935571:function(t,e,s){"use strict";function a(t){return t&&t.__esModule?t:{default:t}}var r=s(0x68ccbe1ec01b),n=a(r),i=s(8838421736604965),o=a(i),u=s(5708247199348607),l=a(u),c=s(5896763357248615),d=s(0x8ae3881d6e8c2),p=s(0x45d24eaab7654),f=s(0x8f7d57519e61b),h=s(5628363501489590),m=s(0xa505046780b0c),g=s(709335331861514),v=s(0xa72c09d16709f),_=s(7676928569480141),E=s(0xc46966cb87a6f),y=s(72591479426812),P=s(6104353596224629),S=s(0x7df7df5329b0e),T=s(0x5dd72de17825d),b=s(4740245423068679).hasTouch;t.exports=c.createClass({displayName:"Draft",mixins:[S],propTypes:{showAllActions:c.PropTypes.bool,post:c.PropTypes.object,isPlaceholder:c.PropTypes.bool,sites:c.PropTypes.object,onTitleClick:c.PropTypes.func,postImages:c.PropTypes.object,selected:c.PropTypes.bool,showAuthor:c.PropTypes.bool},getDefaultProps:function(){return{showAllActions:!1,onTitleClick:p,selected:!1,showAuthor:!1}},getInitialState:function(){return{fullImage:!1,showPopoverMenu:!1,isRestoring:!1,hasError:!1}},toggleImageState:function(){this.setState({fullImage:!this.state.fullImage})},trashPost:function(){var t;this.setState({showPopoverMenu:!1,isTrashing:!0}),t=function(t){if(this.isMounted())return t?this.setState({isTrashing:!1,hasError:!0}):this.setState({isTrashing:!1})}.bind(this),T.userCan("delete_post",this.props.post)&&P.trash(this.props.post,t)},restorePost:function(){var t;this.setState({showPopoverMenu:!1,isRestoring:!0}),t=function(t){if(this.isMounted())return t?this.setState({
isRestoring:!1,hasError:!0}):this.setState({isRestoring:!1})}.bind(this),T.userCan("delete_post",this.props.post)&&P.restore(this.props.post,t)},previewPost:function(){window.open(T.getPreviewURL(this.props.post))},publishPost:function(){this.setState({showPopoverMenu:!1}),T.userCan("publish_post",this.props.post)&&this.updatePostStatus("publish")},togglePopoverMenu:function(){this.setState({showPopoverMenu:!this.state.showPopoverMenu})},render:function(){var t,e,s,a,r,i=this.props.post,u=null;return this.props.isPlaceholder?this.postPlaceholder():(t=this.props.sites.getSite(i.site_ID),T.userCan("edit_post",i)&&(a=T.getEditURL(i,t)),this.props.postImages&&this.props.postImages.canonical_image&&(u=f.parse(this.props.postImages.canonical_image.uri,!0),s="//"+u.hostname+u.pathname+"?w=680px"),i&&i.canonical_image&&(u=f.parse(i.canonical_image.uri,!0),s=u.hostname.indexOf("files.wordpress.com")>0?"//"+u.hostname+u.pathname+"?w=680px":(0,o.default)(i.canonical_image.uri,{width:680})),e=d("draft","is-"+i.format,{"has-all-actions":this.props.showAllActions,"has-image":!!u,"is-image-expanded":this.state.fullImage,"is-trashed":"trash"===this.props.post.status||this.state.isTrashing,"is-placeholder":this.props.isPlaceholder,"is-restoring":this.state.isRestoring,"is-touch":b(),"is-selected":this.props.selected}),r=i.title||c.createElement("span",{className:"draft__untitled"},this.translate("Untitled")),c.createElement(h,{className:e,key:"draft-"+i.ID},this.showStatusChange(),c.createElement("h3",{className:"draft__title"},"pending"===i.status&&c.createElement("span",{className:"draft__pending-label"},this.translate("Pending")),this.props.showAuthor&&c.createElement(n.default,{user:i.author,size:22}),c.createElement("a",{href:a,onClick:this.props.onTitleClick},r)),i.excerpt&&c.createElement("span",{className:"draft__excerpt"},c.createElement("a",{href:a,onClick:this.props.onTitleClick},i.excerpt)),this.props.sites.selected?this.draftActions():c.createElement(v,{site:t,size:32}),u?this.renderImage(s):null,"trash"===this.props.post.status?this.restoreButton():null))},renderImage:function(t){var e;return this.state.fullImage||(e={backgroundImage:"url("+t+")"}),c.createElement("div",{className:"draft__featured-image",style:e,onClick:this.toggleImageState},this.state.fullImage?c.createElement("img",{className:"draft__image",src:t}):null)},restoreButton:function(){return this.state.isRestoring?null:c.createElement("button",{className:"draft__restore",onClick:this.restorePost},c.createElement(m,{icon:"undo",size:18}),this.translate("Restore"))},showStatusChange:function(){return"publish"===this.props.post.status?c.createElement(l.default,{isCompact:!0,status:"is-success",text:"Post successfully published.",button:"View",showDismiss:!1},c.createElement(g,{href:this.props.post.URL},"View")):this.state.hasError?c.createElement(l.default,{isCompact:!0,status:"is-error",text:"There was a problem.",showDismiss:!1}):void 0},postPlaceholder:function(){return c.createElement(h,{className:"draft is-placeholder"},c.createElement("h3",{className:"draft__title"}),c.createElement("div",{className:"draft__actions"},c.createElement("p",{className:"post-relative-time-status"},c.createElement("span",{className:"time"},c.createElement("span",{className:"noticon noticon-time"}),c.createElement("span",{className:"time-text"})))))},renderTrashAction:function(){return T.userCan("delete_post",this.props.post)?"trash"===this.props.post.status||this.state.isRestoring?null:c.createElement("div",{className:"draft__actions"},c.createElement(m,{icon:"trash",onClick:this.trashPost,size:18})):null},renderAllActions:function(){return c.createElement("div",{className:"draft__all-actions"},c.createElement(_,{post:this.props.post,includeEditLink:!0}),c.createElement("span",{className:"draft__actions-toggle noticon noticon-ellipsis",onClick:this.togglePopoverMenu,ref:"popoverMenuButton"}),c.createElement(E,{isVisible:this.state.showPopoverMenu,onClose:this.togglePopoverMenu,position:"bottom left",context:this.refs&&this.refs.popoverMenuButton},c.createElement(y,{onClick:this.previewPost},this.translate("Preview")),c.createElement(y,{onClick:this.publishPost},this.translate("Publish")),c.createElement(y,{className:"draft__trash-item",onClick:this.trashPost},this.translate("Send to Trash"))))},draftActions:function(){return this.props.showAllActions?this.renderAllActions():this.renderTrashAction()}})},9002016994434229:function(t,e,s){function a(t,e,s){var a=l(t)||p(t);if(e=o(e,4),null==s)if(a||d(t)){var f=t.constructor;s=a?l(t)?new f:[]:c(f)?n(u(t)):{}}else s={};return(a?r:i)(t,function(t,a,r){return e(s,t,a,r)}),s}var r=s(6653100901949564),n=s(0xdb012454e44dc),i=s(8070933214026328),o=s(953537273159943),u=s(8588778371469377),l=s(6994352954282616),c=s(0x729562806a912),d=s(6817336032113752),p=s(4692643253343335);t.exports=a}});